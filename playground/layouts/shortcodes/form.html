<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/monokai.css" type="text/css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/highlight.min.js"></script>

{{ $action := .Get "action" | default "thank-you" -}}
{{- if ne $action "thank-you" -}}{{- $action := ($action | absLangURL) -}}{{- end -}}
<form action="{{ $action }}">
  {{ .Inner }}
  <div class="row">
    <button type="reset" class="btn btn-primary">Reset</button>
    <button type="submit" class="btn btn-primary">Submit</button>
  </div>
</form>
<div class="highlight">
  <pre class="chroma external">
    <code class="json" id="response"></code>
  </pre>
</div>

<script>
  const handleSubmit = (event) => {
  event.preventDefault();

  const myForm = event.target;
  const formData = new FormData(myForm);
  
  fetch(myForm.action, {
    method: "POST",
    headers: { "Content-Type": "application/x-www-form-urlencoded" },
    body: new URLSearchParams(formData).toString(),
  }).then((response) => {
    if (!response.ok) {
      //throw new Error(`HTTP error: ${response.status}`);
      console.log(`HTTP error: ${response.status}`);
    }
    console.log("Form successfully submitted");
    return response.text();
  }).then((text) => {
    const response = document.querySelector('#response');
    response.innerHTML = JSON.stringify(JSON.parse(text),null,2);
    hljs.highlightBlock(response);
  });
};

document
  .querySelector("form")
  .addEventListener("submit", handleSubmit);
</script>